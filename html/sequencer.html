<!DOCTYPE html>
<html>
  <head>
    <title>MIDI Socket - Sequencer</title>
    <link rel="stylesheet" href="css/sequencer.css">
    <link rel="stylesheet" href="css/routingMatrix.css">
    <link rel="stylesheet" href="css/color-transitions.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LCC0RPQNKH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LCC0RPQNKH');
    </script>
  </head>
  <body>

    <!-- Session Header -->
    <div id="session-header">
      <h1>MIDI Routing Sequencer</h1>
      <div id="session-info">
        <span id="session-name">Session: <strong>-</strong></span>
        <span id="session-status">Status: <strong>Waiting...</strong></span>
        <span id="midi-status">MIDI: <strong>Loading...</strong></span>
      </div>
    </div>

    <!-- Control Panel -->
    <div id="controls">
      <div id="session-controls">
        <button id="play-button" class="control-btn" title="Start session for all tracks">
          ▶️ Start Session
        </button>
        <button id="pause-button" class="control-btn" title="Pause session for all tracks">
          ⏸️ Pause Session
        </button>
        <button id="panic-all" class="control-btn danger" title="Send panic (all notes off) to all devices">
          🛑 Panic All
        </button>
      </div>
      
      <div id="view-controls">
        <button id="info-toggle" class="control-btn" title="Show/hide device information">
          ℹ️ Device Info
        </button>
        <button id="stats-toggle" class="control-btn" title="Show/hide routing statistics">
          📊 Statistics
        </button>
      </div>
    </div>

    <!-- Device Status Panel -->
    <div id="device-panel" class="panel">
      <h3>📱 MIDI Devices</h3>
      <div id="device-status">
        <div class="loading">Detecting MIDI devices...</div>
      </div>
      <div id="device-list"></div>
    </div>

    <!-- Statistics Panel -->
    <div id="stats-panel" class="panel hidden">
      <h3>📊 Routing Statistics</h3>
      <div id="stats-content">
        <div class="stat-item">
          <label>Active Tracks:</label>
          <span id="stat-active-tracks">0</span>
        </div>
        <div class="stat-item">
          <label>Routed Tracks:</label>
          <span id="stat-routed-tracks">0</span>
        </div>
        <div class="stat-item">
          <label>Messages Routed:</label>
          <span id="stat-messages-routed">0</span>
        </div>
        <div class="stat-item">
          <label>Routing Errors:</label>
          <span id="stat-routing-errors">0</span>
        </div>
      </div>
    </div>

    <!-- Main Routing Matrix -->
    <div id="routing-matrix">
      <h3>🎵 Track Routing Matrix</h3>
      <div id="matrix-container">
        <table id="routing-table">
          <thead>
            <tr>
              <th>Track</th>
              <th>User</th>
              <th>Status</th>
              <th>MIDI Device</th>
              <th>Channel</th>
              <th>Volume</th>
              <th>Transpose</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="routing-table-body">
            <!-- Track rows will be dynamically generated here -->
          </tbody>
        </table>
        
        <div id="no-tracks-message" class="empty-state">
          <h4>No tracks connected</h4>
          <p>Waiting for users to join the session...</p>
          <p>Share this URL with participants:</p>
          <div id="track-url-display">
            <code id="track-url">Loading...</code>
            <button id="copy-url" title="Copy URL to clipboard">📋</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Error/Info Messages -->
    <div id="message-area">
      <div id="error-message" class="message error hidden"></div>
      <div id="info-message" class="message info hidden"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.4.0/socket.io.min.js"></script>
    <script src="scripts/include.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/midiDeviceManager.js"></script>
    <script src="scripts/routingMatrix.js"></script>
    <script src="scripts/midiRouting.js"></script>
    <script src="scripts/sequencer.js"></script>
  </body>
</html>